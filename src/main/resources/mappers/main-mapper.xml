<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="mainMapper">
	<select id="selectBucketList" resultMap="BucketResultSet">
		select *
		from
		    (select BKNO, BKNAME, BKCONTENT, TAG, b.ENROLLDATE, BKLIKE, nickname, COMPLETE, CATENUM
		    from bucketList b
		    join member using(userid)
		    UNION
		    select b.BKNO BKNO, BKNAME, BKCONTENT, TAG, s.ENROLLDATE ENROLLDATE, BKLIKE, nickname, COMPLETE, CATENUM
		    from bucketList b
		    join SHAREBUCKET s on (b.bkNo = s.bkNo)
		    join member m on (s.userid = m.userid))
		order by ENROLLDATE desc
	</select>
	<resultMap type="Bucket" id="BucketResultSet">
		<id property="bkNo" column="BKNO"/>
		<result property="bkName" column="BKNAME"/>
		<result property="bkContent" column="BKCONTENT"/>
		<result property="tag" column="TAG"/>
		<result property="enrolldate" column="ENROLLDATE"/>
		<result property="bkLike" column="BKLIKE"/>
		<result property="userId" column="NICKNAME"/>
		<result property="complete" column="COMPLETE"/>
		<result property="cateNum" column="CATENUM"/>
	</resultMap>
	
	<select id="selectBLImg" resultMap="MediaResultSet">
		select *
		from media
		where bkno is not null
	</select>
	<resultMap type="Media" id="MediaResultSet">
		<id property="mnumber" column="MNUMBER"/>
		<result property="morigin" column="MORIGIN"/>
		<result property="mweb" column="MWEB"/>
		<result property="imgvideo" column="IMGVIDEO"/>
		<result property="muse" column="MUSE"/>
		<result property="bkno" column="BKNO"/>
		<result property="bno" column="BNO"/>
		<result property="coid" column="COID"/>
		<result property="feno" column="FENO"/>
		<result property="esNo" column="ES_NO"/>
	</resultMap>
	
	<!-- 메인 버킷 좋아요 -->
	<select id="blLikeCheck" resultType="_int">
		select count(*)
		from bucketlike
		where userid = #{userId}
		and bkNo = #{bkNo}
	</select>
	<update id="blLikeDown">
		update bucketlist
		set bklike = bklike - 1
		where bkno = #{bkNo}
	</update>
	<delete id="deleteblLike">
		delete from bucketlike
		where userid = #{userId}
		and bkNo = #{bkNo}
	</delete>
	<update id="blLikeUp">
		update bucketlist
		set bklike = bklike + 1
		where bkno = #{bkNo}
	</update>
	<insert id="insertblLike">
		insert into bucketlike
		values(seq_bucketlike.nextval, sysdate, #{userId}, #{bkNo})
	</insert>
	<select id="blLike" resultType="_int">
		select bklike
		from bucketlist
		where bkNo = #{bkNo}
	</select>
	
	<!-- 위시 등록취소 -->
	<select id="blWishCheck" resultType="_int">
		select count(*)
		from wishlist
		where userid = #{userId}
		and bkNo = #{bkNo}
	</select>
	<delete id="deleteWish">
		delete from wishlist
		where userid = #{userId}
		and bkNo = #{bkNo}
	</delete>
	<insert id="insertWish">
		insert into wishlist
		values(seq_wishlist.nextval, sysdate, #{bkNo}, #{userId})
	</insert>
	
	<!-- 로그인한 회원 위시리스트 -->
	<select id="selectWishList" resultType="WishList">
		select *
		from wishlist
		where userid = #{userId}
	</select>
	
	<!-- 버킷공유하기 -->
	<insert id="blShere">
		insert into sharebucket
		values(seq_sharebucket.nextval, #{bkNo}, #{userId}, sysdate)
	</insert>
	
	<!-- 로그인한 회원 공유버킷리스트 -->
	<select id="selectShereList" resultType="ShareBucket">
		select *
		from sharebucket
		where userid = #{userId}
	</select>
	
	<!-- 이 버킷공유한 버킷회원 -->
	<select id="selectShareMList" parameterType="_int" resultMap="memberResultSet">
		select *
		from member
		join sharebucket using(userid)
		where bkno = #{bkNo}
	</select>
	<resultMap id="memberResultSet" type="Member">
	<id property="userId" column="USERID"/>
	<result property="userPwd" column="USERPWD"/>
	<result property="userName" column="USERNAME"/>
	<result property="phone" column="PHONE"/>
	<result property="email" column="EMAIL"/>
	<result property="birth" column="BIRTH"/>
	<result property="gender" column="GENDER"/>
	<result property="nickName" column="NICKNAME"/>
	<result property="caution" column="CAUTION"/>
	<result property="prImage" column="PR_IMAGE"/>
	<result property="fwCount" column="FW_COUNT"/>
	<result property="enrollDate" column="ENROLLDATE"/>
	</resultMap>
	
	<!-- 블로그불러오기 -->
	<select id="selectbMList" resultType="Board">
		select *
		from board
		where bkno = #{bkNo}
	</select>
	
</mapper>
