<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="memberMapper">

	<insert id="insertBucket">
		insert into bucketlist
		values(seq_bucketlist.nextval, #{bkName}, #{bkContent}, #{tag}, sysdate, 0, #{userId},
		default, #{cateNum})
	</insert>

	<insert id="insertbMedia">
		insert into media
		values(seq_media.nextval, #{morigin}, #{mweb}, 1, 1, seq_bucketlist.currval, null,
		null, null, null)
	</insert>

	<select id="myBucketList" resultMap="memberMyBucketListResultSet">
		select *
		from (
            select CATENUM, CATENAME, b.BKNO BKNO, BKNAME, BKCONTENT, TAG, b.ENROLLDATE ENROLLDATE, 
            BKLIKE, b.USERID USERID, COMPLETE, MNUMBER, MORIGIN, MWEB, IMGVIDEO, MUSE, BNO, COID, FENO, ES_NO, m.userName USERNAME, EMAIL,
            BIRTH, GENDER, NICKNAME, CAUTION, PR_IMAGE, FW_COUNT, m.ENROLLDATE ENROLLDATE2, STATUS
            from category
            join bucketList b using (cateNum)
            join media md on (b.bkno = md.bkno)
            join member m on (b.userid = m.userid)
            UNION    
            select CATENUM, CATENAME, b.BKNO BKNO, BKNAME, BKCONTENT, TAG, s.ENROLLDATE ENROLLDATE, 
            BKLIKE, b.userid USERID, COMPLETE, MNUMBER, MORIGIN, MWEB, IMGVIDEO, MUSE, BNO, COID, FENO, ES_NO, m.userName USERNAME, EMAIL,
            BIRTH, GENDER, NICKNAME, CAUTION, PR_IMAGE, FW_COUNT, m.ENROLLDATE ENROLLDATE2, STATUS
            from category
            join bucketList b using (cateNum)
            join media md on (b.bkno = md.bkno)
            join SHAREBUCKET s on (b.bkNo = s.bkNo)
            join member m on (s.userid = m.userid))
		where nickName=#{ nickName } and status = 'Y'
		order by ENROLLDATE desc
	</select>
	
	<select id="myBucketListPage" resultMap="memberMyBucketListResultSet">
		select *
		from (
            select CATENUM, CATENAME, b.BKNO BKNO, BKNAME, BKCONTENT, TAG, b.ENROLLDATE ENROLLDATE, 
            BKLIKE, b.USERID USERID, COMPLETE, MNUMBER, MORIGIN, MWEB, IMGVIDEO, MUSE, BNO, COID, FENO, ES_NO, m.userName USERNAME, EMAIL,
            BIRTH, GENDER, NICKNAME, CAUTION, PR_IMAGE, FW_COUNT, m.ENROLLDATE ENROLLDATE2, STATUS
            from category
            join bucketList b using (cateNum)
            join media md on (b.bkno = md.bkno)
            join member m on (b.userid = m.userid)
            UNION    
            select CATENUM, CATENAME, b.BKNO BKNO, BKNAME, BKCONTENT, TAG, s.ENROLLDATE ENROLLDATE, 
            BKLIKE, b.userid USERID, COMPLETE, MNUMBER, MORIGIN, MWEB, IMGVIDEO, MUSE, BNO, COID, FENO, ES_NO, m.userName USERNAME, EMAIL,
            BIRTH, GENDER, NICKNAME, CAUTION, PR_IMAGE, FW_COUNT, m.ENROLLDATE ENROLLDATE2, STATUS
            from category
            join bucketList b using (cateNum)
            join media md on (b.bkno = md.bkno)
            join SHAREBUCKET s on (b.bkNo = s.bkNo)
            join member m on (s.userid = m.userid))
		where nickName=#{ nickName } and status = 'Y'
		order by ENROLLDATE desc
	</select>
	
	<resultMap type="MemberMyBucketList" id="memberMyBucketListResultSet">
		<id property="bkNo" column="BKNO"></id>
		<result property="cateNum" column="CATENUM" />
		<result property="cateName" column="CATENAME" />
		<association property="bucket" resultMap="BucketListResultSet"></association>
		<association property="media" resultMap="MediaResultSet"></association> 
		<association property="member" resultMap="memberResultSet"></association> 
	</resultMap>
		
	<resultMap type="Bucket" id="BucketListResultSet">
		<result property="bkNo" column="BKNO"/>
		<result property="bkName" column="BKNAME"/>
		<result property="bkContent" column="BKCONTENT"/>
		<result property="tag" column="TAG"/>
		<result property="enrolldate" column="ENROLLDATE"/>
		<result property="bkLike" column="BKLIKE"/>
		<result property="userId" column="USERID"/>
		<result property="complete" column="COMPLETE"/>
		<result property="cateNum" column="CATENUM"/>
	</resultMap>
	
	<resultMap type="Media" id="MediaResultSet">
		<result property="mnumber" column="MNUMBER"/>
		<result property="morigin" column="MORIGIN"/>
		<result property="mweb" column="MWEB"/>
		<result property="imgvideo" column="IMGVIDEO"/>
		<result property="muse" column="MUSE"/>
		<result property="bkno" column="BKNO"/>
		<result property="bno" column="BNO"/>
		<result property="coid" column="COID"/>
		<result property="feno" column="FENO"/>
		<result property="esNo" column="ES_NO"/>
	</resultMap>
	
	<resultMap id="memberResultSet" type="Member">
		<id property="userId" column="USERID"/>
		<result property="userPwd" column="USERPWD"/>
		<result property="userName" column="USERNAME"/>
		<result property="phone" column="PHONE"/>
		<result property="email" column="EMAIL"/>
		<result property="birth" column="BIRTH"/>
		<result property="gender" column="GENDER"/>
		<result property="nickName" column="NICKNAME"/>
		<result property="caution" column="CAUTION"/>
		<result property="prImage" column="PR_IMAGE"/>
		<result property="fwCount" column="FW_COUNT"/>
		<result property="enrollDate" column="ENROLLDATE2"/>
		<result property="status" column="STATUS"/>
	</resultMap>
	
	<insert id="blogInsert" parameterType="Board">
		insert into board
		values (SEQ_BOARD.NEXTVAL, #{ bTitle }, #{ bContent }, DEFAULT, DEFAULT, SYSDATE, DEFAULT, #{ userid }, #{ bkNo })
	</insert>
	
	<select id="getUserId" resultType="string">
		select userid
		from member
		where nickname = #{ nickName } and status='Y'
	</select>
	
	<select id="getMember" resultMap="memberResultSet">
		select *
		from member
		where nickname = #{ nickName } and status='Y'
	</select>
	
	<select id="getBoard" parameterType="hashMap" resultMap="BoardResultSet">
		select *
		from board
		where userid = #{ userid } and bkno = #{ bn } and status = 'Y'
		order by enrolldate
	</select>
	
	<resultMap type="Board" id="BoardResultSet">
		<id property="bNo" column="BNO"></id>
		<result property="bTitle" column="BTITLE"></result>
		<result property="bContent" column="BCONTENT"></result>
		<result property="bLike" column="BLIKE"></result>
		<result property="bCount" column="BCOUNT"></result>
		<result property="enrollDate" column="ENROLLDATE"></result>
		<result property="status" column="STATUS"></result>
		<result property="userid" column="USERID"></result>
		<result property="bkNo" column="BKNO"></result>
	</resultMap>
	
	<select id="getListCount" resultType="_int">
		select count(*)
		from (
            select CATENUM, CATENAME, b.BKNO BKNO, BKNAME, BKCONTENT, TAG, b.ENROLLDATE ENROLLDATE, 
            BKLIKE, b.USERID USERID, COMPLETE, MNUMBER, MORIGIN, MWEB, IMGVIDEO, MUSE, BNO, COID, FENO, ES_NO, m.userName USERNAME, EMAIL,
            BIRTH, GENDER, NICKNAME, CAUTION, PR_IMAGE, FW_COUNT, m.ENROLLDATE ENROLLDATE2, STATUS
            from category
            join bucketList b using (cateNum)
            join media md on (b.bkno = md.bkno)
            join member m on (b.userid = m.userid)
            UNION    
            select CATENUM, CATENAME, b.BKNO BKNO, BKNAME, BKCONTENT, TAG, s.ENROLLDATE ENROLLDATE, 
            BKLIKE, b.userid USERID, COMPLETE, MNUMBER, MORIGIN, MWEB, IMGVIDEO, MUSE, BNO, COID, FENO, ES_NO, m.userName USERNAME, EMAIL,
            BIRTH, GENDER, NICKNAME, CAUTION, PR_IMAGE, FW_COUNT, m.ENROLLDATE ENROLLDATE2, STATUS
            from category
            join bucketList b using (cateNum)
            join media md on (b.bkno = md.bkno)
            join SHAREBUCKET s on (b.bkNo = s.bkNo)
            join member m on (s.userid = m.userid))
		where nickName=#{ nickName } and status = 'Y'
		order by ENROLLDATE desc
	</select>
	

	
	
</mapper>
