<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTO Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="exMapper">

	<select id="selectCompanyInfo" resultMap="CompanyResultSet">
		select * 
		from company
		where coid=#{coId} and status='Y'
	</select>
	
	<resultMap id="CompanyResultSet" type="Company">
		<id property="coId" column="COID"/>
		<result property="pwd" column="COPWD"/>
		<result property="coName" column="CONAME"/>
		<result property="compaName" column="COMPANAME"/>
		<result property="apName" column="APNAME"/>
		<result property="homePage" column="HOMEPAGE"/>
		<result property="coTel" column="COTEL"/>
		<result property="enrollDate" column="ENROLLDATE"/>
		<result property="status" column="STATUS"/>
		<result property="approval" column="APPROVAL"/>
		<result property="busiEmail" column="BUSIEMAIL"/>
		<result property="cpCheck" column="CPCHECK"/>
		<result property="checkImg" column="CHECKIMG"/>
		<result property="point" column="POINT"/>
		<result property="cateNum" column="CATENUM"/>
		<result property="coIntro" column="COINTRO"/>
		<result property="coInfo" column="COINFO"/>
	</resultMap>

	<update id="updateExInfo">
		update company 
		set cointro=#{coIntro}, coinfo=#{coInfo}
		where coid=#{coId}
	</update>
	
	<select id="selectCateList" resultMap="BucketResultSet">
		select *
		from bucketlist
		where catenum = #{catenum}
	
	</select>
	
	<resultMap type="Bucket" id="BucketResultSet">
		<id property="bkNo" column="BKNO"/>
		<result property="bkName" column="BKNAME"/>
		<result property="bkContent" column="BKCONTENT"/>
		<result property="tag" column="TAG"/>
		<result property="enrolldate" column="ENROLLDATE"/>
		<result property="bkLike" column="BKLIKE"/>
		<result property="userId" column="USERID"/>
		<result property="complete" column="COMPLETE"/>
		<result property="cateNum" column="CATENUM"/>
	</resultMap>
	
	<update id="insertComBucket">
		insert into cominbucket(COINBUCKET,COID,BKNO,BUCKETENROLL)
		select seq_cominbucket.nextval,A.* from(
		<foreach item="item" index="index" collection="list" separator="UNION ALL ">
			select #{item.coId} as COID,
				   #{item.bkNo} as BKNO,
				   sysdate as BUCKETENROLL
			from dual
		</foreach>) A
 	</update>
	
	<select id="selectBucket" resultMap="BucketResultSet">
		select *
		from bucketlist
		where bkno in (select bkno 
                    from cominbucket 
                    where coid=#{coid})
	</select>
	
	
	
	<resultMap type="ComInBucket" id="ComInBucketSet">
		<id property="coinbucket" column="COINBUCKET"/>
		<result property="coId" column="COID"/>
		<result property="bkNo" column="BKNO"/>
		<result property="bucketEnroll" column="BUCKETENROLL"/>
	</resultMap>
</mapper>
